<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚úñÔ∏è Integer Multiplication Quest</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: Comic Sans MS, cursive; background: #111; }
    #questionBox {
      position: absolute;
      top: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(255,255,255,0.95);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      display: none;
      z-index: 20;
    }
    #questionBox h2 { margin: 0 0 10px; color: #333; }
    #answerInput { font-size: 1.2em; padding: 5px; width: 100px; text-align: center; }
    #submitBtn, #restartBtn {
      font-size: 1em; padding: 8px 15px; margin: 8px;
      border: none; border-radius: 5px; cursor: pointer;
      background: #00cc66; color: #fff;
    }
    #restartBtn {
      position: absolute; top: 20px; right: 20px; background: #ff6600;
      z-index: 20;
    }
    canvas { display: block; z-index: 1; position: relative; }
  </style>
</head>
<body>
  <div id="questionBox">
    <h2 id="questionText"></h2>
    <input type="text" id="answerInput" placeholder="Answer">
    <button id="submitBtn">Submit</button>
    <div id="feedback"></div>
  </div>
  <button id="restartBtn">üîÑ Restart</button>

  <audio id="applauseSound" src="https://cdn.pixabay.com/download/audio/2021/09/15/audio_21b1dd5c93.mp3?filename=applause-weak-01-116117.mp3"></audio>

  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>

  <script>
  let scene, camera, renderer, player, barriers = [];
  let currentBarrier = 0;
  let questions = [];
  let answers = [];

  let speed = 0.15; // slightly faster
  let pathPoints = [];
  let particles = [];
  let fireworksActive = false;

  const successMessages = [
    "üåü Great job!", "üî• You rock!", "üéâ Keep going!",
    "üí° Smart thinking!", "üöÄ Awesome!", "üëè Brilliant!", "‚ú® Fantastic!"
  ];

  function initScene() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x88ccff);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 10);

    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.domElement.style.position = "absolute";
    renderer.domElement.style.top = 0;
    renderer.domElement.style.left = 0;
    document.body.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(10,20,10);
    scene.add(light);

    const groundGeo = new THREE.PlaneGeometry(400, 400);
    const groundMat = new THREE.MeshPhongMaterial({color: 0x228822});
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI/2;
    scene.add(ground);

    // Player = sprite with texture
    const textureLoader = new THREE.TextureLoader();
    const playerTexture = textureLoader.load("character1.png");
    const playerMat = new THREE.MeshBasicMaterial({ map: playerTexture, transparent: true });
    const playerGeo = new THREE.PlaneGeometry(2, 2.5);
    player = new THREE.Mesh(playerGeo, playerMat);
    player.position.set(0, 1.3, 2);
    scene.add(player);

    createZigzagPath();
    generateQuestions();
  }

  function createZigzagPath(){
    barriers.forEach(b=>scene.remove(b));
    barriers = [];
    pathPoints = [];

    const pathMat = new THREE.MeshPhongMaterial({color: 0x888888});

    let x=0, z=0, direction="z";
    for(let i=0;i<10;i++){
      if(direction==="z"){
        z -= 12;
        direction="x";
      } else {
        x += (i%2===0? 12 : -12); 
        direction="z";
      }
      pathPoints.push({x, z});

      let block = new THREE.Mesh(new THREE.BoxGeometry(6,0.5,6), pathMat);
      block.position.set(x,0.25,z);
      scene.add(block);

      const barrierMat = new THREE.MeshPhongMaterial({color: 0xff0000});
      let barrier = new THREE.Mesh(new THREE.BoxGeometry(4,3,0.5), barrierMat);
      barrier.position.set(x,1.5,z);
      scene.add(barrier);
      barriers.push(barrier);
    }
  }

  function generateQuestions(){
    questions = [];
    answers = [];
    for (let i=0;i<10;i++){
      let a, b;
      let caseType = Math.floor(Math.random()*3);
      if(caseType === 0){ // 1-digit x 1-digit
        a = Math.floor(Math.random()*9)+1;
        b = Math.floor(Math.random()*9)+1;
      } else if(caseType === 1){ // 1-digit x 2-digit
        a = Math.floor(Math.random()*9)+1;
        b = Math.floor(Math.random()*90)+10;
      } else { // 2-digit x 1-digit
        a = Math.floor(Math.random()*90)+10;
        b = Math.floor(Math.random()*9)+1;
      }
      let q = `${a} √ó ${b}`;
      let ans = a*b;
      questions.push(q);
      answers.push(ans);
    }
  }

  function showQuestion(){
    let box = document.getElementById("questionBox");
    box.style.display = "block";
    document.getElementById("questionText").textContent = 
      `Barrier ${currentBarrier+1}: Solve ${questions[currentBarrier]}`;
    document.getElementById("answerInput").value = "";
    document.getElementById("feedback").textContent = "";
    document.getElementById("answerInput").focus();
  }

  function checkAnswer(){
    let val = parseInt(document.getElementById("answerInput").value);
    if(val === answers[currentBarrier]){
      let msg = successMessages[Math.floor(Math.random()*successMessages.length)];
      document.getElementById("feedback").textContent = msg;
      scene.remove(barriers[currentBarrier]);
      currentBarrier++;
      setTimeout(()=>{
        document.getElementById("questionBox").style.display = "none";
        if(currentBarrier === barriers.length){
          triggerCelebration();
        }
      },1000);
    } else {
      document.getElementById("feedback").textContent = "‚ùå Oops, try again!";
    }
  }

  function triggerCelebration(){
    fireworksActive = true;
    document.getElementById("applauseSound").play();

    for(let i=0;i<200;i++){
      let particleGeo = new THREE.SphereGeometry(0.1, 8, 8);
      let particleMat = new THREE.MeshPhongMaterial({color: Math.random()*0xffffff});
      let particle = new THREE.Mesh(particleGeo, particleMat);
      particle.position.set(player.position.x, player.position.y+2, player.position.z);
      particle.velocity = {
        x:(Math.random()-0.5)*0.8,
        y:(Math.random())*0.8,
        z:(Math.random()-0.5)*0.8
      };
      particles.push(particle);
      scene.add(particle);
    }
  }

  function animate(){
    requestAnimationFrame(animate);

    if(currentBarrier < barriers.length){
      let target = pathPoints[currentBarrier];
      if(!target) return;

      let dx = target.x - player.position.x;
      let dz = target.z - player.position.z;
      let dist = Math.sqrt(dx*dx + dz*dz);

      if(dist > 0.2){
        player.position.x += (dx/dist)*speed;
        player.position.z += (dz/dist)*speed;
        camera.position.x += (dx/dist)*speed;
        camera.position.z += (dz/dist)*speed;
      } else {
        if(document.getElementById("questionBox").style.display === "none"){
          showQuestion();
        }
      }
    }

    if(fireworksActive){
      particles.forEach(p=>{
        p.position.x += p.velocity.x;
        p.position.y += p.velocity.y;
        p.position.z += p.velocity.z;
        p.velocity.y -= 0.01;
      });
    }

    renderer.render(scene, camera);
  }

  function restartGame(){
    currentBarrier = 0;
    player.position.set(0,1.3,2);
    camera.position.set(0,5,10);
    generateQuestions();
    createZigzagPath();
    document.getElementById("questionBox").style.display = "none";
    particles.forEach(p=>scene.remove(p));
    particles = [];
    fireworksActive = false;
  }

  document.getElementById("submitBtn").onclick = checkAnswer;
  document.getElementById("restartBtn").onclick = restartGame;
  document.getElementById("answerInput").addEventListener("keydown", e=>{
    if(e.key==="Enter") checkAnswer();
  });

  initScene();
  animate();
  </script>
</body>
</html>
